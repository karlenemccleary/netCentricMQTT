<!DOCTYPE html>
<html>

<head> 
	<title>CMPSC 421</title>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.1.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
<script>


function myFunction() {
  // Declare variables 
  var input, filter, table, tr, td, i;
  table = document.getElementById("myTable");
  tr = table.getElementsByTagName("tr");

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[1];
    console.log(td);

  //  if (td.toString() == "<td>JSON</td>") {
 //   	console.log("YESS")
 //   } 
  }
}
</script>

	<style type="text/css">
		table {
			width: 600px;
		}
		table, th, td {
			border: 1px solid black;
		}
	</style>

</head>

<body onload="myFunction()">
	<h1> CMPSC 421 Net Centric Computing </h1>
	<h3> AJAX</h2>
<table id = "myTable">
  <tr>
    <th>Topic</th>
    <th>Format</th> 
    <th>TimeStamp</th>
  </tr>
    <tr class="a">
    <td>a/b/c/d</td>
    <td>JSON</td> 
    <td>10:40 pm</td>
  </tr>
    </tr>
    <tr  class="b">
    <td>a/b/c/e</td>
    <td>XML</td> 
    <td>10:42 pm</td>
  </tr>
  <tr  class="c">
    <td>a/b</td>
    <td>JSON</td> 
    <td>10:43 pm</td>
  </tr>
    <tr  class="d">
    <td>a/b/c</td>
    <td>JSON</td> 
    <td>10:47 pm</td>
  </tr>

    <tr  class="e">
    <td>a/b/c</td>
    <td>XML</td> 
    <td>10:49 pm</td>
  </tr>
	</table>

<script>

//var mqtt = require('mqtt')
//var client  = mqtt.connect('mqtt://test.mosquitto.org')
 

    var wsbroker = "test.mosquitto.org";  //mqtt websocket enabled broker
    var wsport = 8080 // port for above
    var client = new Paho.MQTT.Client(wsbroker, wsport,
        "myclientid_" + parseInt(Math.random() * 100, 10));

    client.onConnectionLost = function (responseObject) {
      console.log("connection lost: " + responseObject.errorMessage);
    };
    client.onMessageArrived = function (message) {
      console.log(message.destinationName, ' -- ', message.payloadString);
      $('#myTable tbody').append('<tr class="a/b/c"><td>' + message.destinationName + '</td><td>'+ message.payloadString +'</td><td>5</td></tr>');
    };

    var options = {
      timeout: 3,
      onSuccess: function () {
        console.log("mqtt connected");
        // Connection succeeded; subscribe to our topic, you can add multile lines of these
        client.subscribe('/World', {qos: 1});
    
        //use the below if you want to publish to a topic on connect
        message = new Paho.MQTT.Message("Hello");
        message.destinationName = "/World";
        client.send(message);
  
         message = new Paho.MQTT.Message("Karlene");
        message.destinationName = "/World";
        client.send(message);

      },
      onFailure: function (message) {
        console.log("Connection failed: " + message.errorMessage);
      }
    };
  function init() {
      client.connect(options);
  }



$(document).ready(function(){
init();
	var arr = [".a", ".b", ".c", ".d", ".e"]
	var colors = ["red", "blue", "green", "yellow", "orange"];
	colors[0] = "red"
	colors[1] = "blue"
	colors[2] = "green"
	colors[3] = "yellow"
  colors[4] = "orange"
	for(i = 0; i < arr.length; i++) {
		$(arr[i]).css("background-color", colors[i]);
    $('#myTable tbody').append('<tr class="a/b/c"><td>blahblah</td><td>2</td><td>3</td></tr>');
    $('#myTable tbody').append('<tr class="a/b/c"><td>blahblah</td><td>2</td><td>3</td></tr>');
		}
	//$("tr:odd").css("background-color", "red");
	//$(("tr":contains("JSON"))).css('color', 'red');

});




</script>




</body>
</html>
